  @Test
  void test_compile_custom_tag() throws Exception {
    String tagLib = "<%@ taglib prefix=\"t\" tagdir=\"/WEB-INF/tags\" %>";
    SensorContextTester ctx = jspContext(tagLib +
      "<t:mytag />");
    // spring tag library is used to complete coverage in Jasper classloader - it has resource which is on the project's
    // classpath
    createJspFile(tagLib +
      SPRING_TLD +
      "<spring:url value=\"/url/path\" />\n" +
      "<h2>Hello World!</h2>", webInf.resolve("tags/mytag.tag"));
    Collection<GeneratedFile> generatedFiles = new Jasper().generateFiles(ctx, singletonList(springJar));

    assertThat(generatedFiles).hasSize(2);
    GeneratedFile testJspFile = generatedFiles.stream().filter(f -> f.filename().equals("test_jsp.java"))
      .findAny().get();
    List<String> testJsp = Files.readAllLines(testJspFile.path());
    assertThat(testJsp).contains(
      "    org.apache.jsp.tag.web.mytag_tag _jspx_th_t_005fmytag_005f0 = new org.apache.jsp.tag.web.mytag_tag();");
    GeneratedFile tagFile = generatedFiles.stream().filter(f -> f.filename().equals("mytag_tag.java"))
      .findAny().get();
    List<String> tag = Files.readAllLines(tagFile.path());
    assertThat(tag).contains("      out.write(\"\\n<h2>Hello World!</h2>\");");
    assertThat(tag).contains("    org.springframework.web.servlet.tags.UrlTag _jspx_th_spring_005furl_005f0 = new org.springframework.web.servlet.tags.UrlTag();");
  }

