  @Test
  public void isMatching_should_call_next_pattern_matcher_with_right_tokens() {
    Token token1 = mockToken("token1");
    Token token2 = mockToken("token2");
    Token token3 = mockToken("token3");

    List<Token> tokensToMatch = Lists.newArrayList(token1);

    Comparator<Token> comparator = mock(Comparator.class);

    PatternMatcher nextPatternMatcher = mock(PatternMatcher.class);
    PatternMatcherResult nextPatternMatcherResultFalse = mock(PatternMatcherResult.class);
    PatternMatcherResult nextPatternMatcherResultTrue = mock(PatternMatcherResult.class);
    when(nextPatternMatcherResultTrue.isMatching()).thenReturn(true);
    when(nextPatternMatcher.match(Mockito.anyList())).thenReturn(nextPatternMatcherResultFalse);
    when(nextPatternMatcher.match(Lists.newArrayList(token2, token3))).thenReturn(nextPatternMatcherResultTrue);
    CommonPatternMatcher patternMatcher = new CommonPatternMatcher(tokensToMatch, comparator, nextPatternMatcher);

    assertThat(patternMatcher.match(Lists.newArrayList(token1, token2, token3)).isMatching()).isEqualTo(true);
    assertThat(patternMatcher.match(Lists.newArrayList(token1, token2)).isMatching()).isEqualTo(false);
  }

