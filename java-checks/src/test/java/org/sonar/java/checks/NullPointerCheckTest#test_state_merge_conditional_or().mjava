  @Test
  public void test_state_merge_conditional_or() {
    VariableSymbol variable1 = mock(VariableSymbol.class);
    VariableSymbol variable2 = mock(VariableSymbol.class);
    VariableSymbol variable3 = mock(VariableSymbol.class);

    // initial state with variables set to not null.
    State currentState = new State();
    currentState.setVariableValue(variable1, NOTNULL);
    currentState.setVariableValue(variable2, NOTNULL);
    currentState.setVariableValue(variable3, NOTNULL);

    State conditionState = new State(currentState);
    ConditionalState conditionalState = new ConditionalState(conditionState);

    // simulates variable1 != null || variable2 != null
    ConditionalState leftConditionalState = new ConditionalState(conditionState);
    leftConditionalState.trueState.setVariableValue(variable1, NOTNULL);
    leftConditionalState.falseState.setVariableValue(variable1, NULL);
    ConditionalState rightConditionalState = new ConditionalState(leftConditionalState.trueState);
    rightConditionalState.trueState.setVariableValue(variable2, NOTNULL);
    rightConditionalState.falseState.setVariableValue(variable2, NULL);
    conditionalState.mergeConditionalOr(leftConditionalState, rightConditionalState);

    // in the resulting trueState variable1 is unknown, since its condition was both true and false,
    // and variable2 is unknown, since its conditiona was either true or not tested.
    assertThat(conditionalState.trueState.getVariableValue(variable1)).isSameAs(UNKNOWN);
    assertThat(conditionalState.trueState.getVariableValue(variable2)).isSameAs(UNKNOWN);
    // in the resulting falseState both conditions are false
    assertThat(conditionalState.falseState.getVariableValue(variable1)).isSameAs(NULL);
    assertThat(conditionalState.falseState.getVariableValue(variable2)).isSameAs(NULL);
    // variables not checked in conditions must remain unchanged.
    assertThat(conditionalState.trueState.getVariableValue(variable3)).isSameAs(NOTNULL);
    assertThat(conditionalState.falseState.getVariableValue(variable3)).isSameAs(NOTNULL);
  }

