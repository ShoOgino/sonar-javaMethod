    char caseFold(char ch) {
      if (flagActive(Pattern.CASE_INSENSITIVE) && (flagActive(Pattern.UNICODE_CASE) || ('A' <= ch && ch <= 'Z'))) {
        return Character.toLowerCase(Character.toUpperCase(ch));
      }
      return ch;
    }

