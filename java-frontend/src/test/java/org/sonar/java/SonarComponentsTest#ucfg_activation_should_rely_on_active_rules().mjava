  @Test
  public void ucfg_activation_should_rely_on_active_rules() {
    File file = new File("src/test/files/ParseError.java");
    SensorContextTester sensorContext = SensorContextTester.create(file.getParentFile().getAbsoluteFile());
    SonarComponents sonarComponents = new SonarComponents(null, null, null, null, null, null);
    sonarComponents.setRuleRepositoryKey("squid");
    sonarComponents.setSensorContext(sensorContext);
    // no security rules available
    JavaRules.ruleKeys = new HashSet<>();
    assertThat(sonarComponents.shouldGenerateUCFG()).isFalse();

    ActiveRules activeRules = new ActiveRulesBuilder().create(RuleKey.of("squid", "S3649")).activate().build();
    // one security rule available
    JavaRules.ruleKeys = new HashSet<>(Arrays.asList("S3649"));
    sensorContext.setActiveRules(activeRules);
    assertThat(sonarComponents.shouldGenerateUCFG()).isTrue();
  }

