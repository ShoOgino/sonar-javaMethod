  @Test
  public void verify_analysis_errors_are_collected_on_parse_error() throws Exception {
    String code = "/***/\nclass A {\n String foo() {\n  return foo();\n }\n";
    SonarComponents sonarComponents = collectAnalysisErrors(code);
    assertThat(sonarComponents.analysisErrors).hasSize(1);
    AnalysisError analysisError = sonarComponents.analysisErrors.get(0);
    assertThat(analysisError.getMessage()).startsWith("Parse error at line 6 column 1:");
    assertThat(analysisError.getCause()).startsWith("com.sonar.sslr.api.RecognitionException: Parse error at line 6 column 1:");
    assertThat(analysisError.getFilename()).endsWith(".tmp");
    assertThat(analysisError.getKind()).isEqualTo(AnalysisError.Kind.PARSE_ERROR);
  }

