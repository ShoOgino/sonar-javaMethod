  /**
   * Utility method to quickly get metric out of a file.
   */
  private void checkMetric(String filename, String metric, Number expectedValue) {
    String relativePath = new File(baseDir, filename).getPath();
    DefaultInputFile inputFile = new DefaultInputFile(context.module().key(), relativePath);
    inputFile.setModuleBaseDir(fs.baseDirPath());
    fs.add(inputFile);
    Measurer measurer = new Measurer(fs, context, mock(NoSonarFilter.class));
    JavaConfiguration conf = new JavaConfiguration(Charsets.UTF_8);
    squid = new JavaSquid(conf, null, measurer, null, null, new CodeVisitor[0]);
    squid.scan(Lists.newArrayList(new File(baseDir, filename)), Collections.<File>emptyList(), Collections.<File>emptyList());
    assertThat(context.measures("projectKey:"+relativePath)).hasSize(NB_OF_METRICS);
    assertThat(context.measure("projectKey:"+relativePath, metric).value()).isEqualTo(expectedValue);
  }

