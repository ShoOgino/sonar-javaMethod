  private static <T> ImmutableList<Integer> flowToLines(Collection<T> flow, ToIntFunction<T> toLineFunction) {
    return flow.stream()
      .mapToInt(toLineFunction)
      .sorted().boxed()
      .collect(collectingAndThen(toList(), ImmutableList::copyOf));
  }

