  @Test
  public void testGetAnnotationValue() {
    String myClass = "org.sonar.java.resolve.targets.annotations.MyClass";
    String myAnnotation = "org.sonar.java.resolve.targets.annotations.MyAnnotation";
    String myOtherAnnotation = "org.bar.MyOtherAnnotation";
    SemanticModel semanticModel = SETestUtils.getSemanticModel("src/test/java/org/sonar/java/resolve/targets/annotations/MyClass.java");

    Symbol.MethodSymbol foo = (Symbol.MethodSymbol) getSymbol(semanticModel, myClass, "foo");
    assertThat(isAnnotatedWith(foo, myAnnotation)).isFalse();
    assertThat(isGloballyAnnotatedWith(foo, myAnnotation)).isTrue();
    // annotation value retrieved from bytecode, on package
    List<SymbolMetadata.AnnotationValue> fooAnnotationValues = valuesForGlobalAnnotation(foo, myAnnotation);
    assertThat(fooAnnotationValues).hasSize(1);
    assertThat(fooAnnotationValues.get(0).name()).isEqualTo("value");
    assertThat(fooAnnotationValues.get(0).value()).isInstanceOf(Object[].class);
    assertThat(((Object[]) fooAnnotationValues.get(0).value())[0]).isInstanceOf(Symbol.class);

    Symbol.MethodSymbol bar = (Symbol.MethodSymbol) getSymbol(semanticModel, myClass, "bar");
    assertThat(isAnnotatedWith(bar, myAnnotation)).isTrue();
    assertThat(isGloballyAnnotatedWith(bar, myAnnotation)).isTrue();
    // annotation value retrieved from source, on method
    List<SymbolMetadata.AnnotationValue> barAnnotationValues = valuesForGlobalAnnotation(bar, myAnnotation);
    assertThat(barAnnotationValues).hasSize(1);
    assertThat(barAnnotationValues.get(0).name()).isEqualTo("value");
    assertThat(barAnnotationValues.get(0).value()).isInstanceOf(NewArrayTree.class);

    Symbol.MethodSymbol qix = (Symbol.MethodSymbol) getSymbol(semanticModel, "org.sonar.java.resolve.targets.annotations.MyOtherClass", "qix");
    assertThat(isAnnotatedWith(qix, myAnnotation)).isFalse();
    assertThat(isGloballyAnnotatedWith(qix, myAnnotation)).isTrue();
    // annotation value retrieved from source, on class
    assertThat(valuesForGlobalAnnotation(qix, myAnnotation)).isEmpty();

    assertThat(isAnnotatedWith(qix, myOtherAnnotation)).isFalse();
    assertThat(isGloballyAnnotatedWith(qix, myOtherAnnotation)).isFalse();
    assertThat(valuesForGlobalAnnotation(qix, myOtherAnnotation)).isNull();
  }

