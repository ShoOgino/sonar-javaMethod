  @Test
  public void rethrow_exception_when_hidden_property_set_to_true() {
    NullPointerException npe = new NullPointerException("BimBadaboum");
    JavaFileScanner visitor = c -> {throw npe;};
    File currentFile = new File("");
    SensorContextTester sensorContextTester = SensorContextTester.create(currentFile);
    SonarComponents sonarComponents = new SonarComponents(null, null, null, null, null);
    sonarComponents.setSensorContext(sensorContextTester);
    VisitorsBridge visitorsBridge = new VisitorsBridge(Collections.singleton(visitor), new ArrayList<>(), sonarComponents);
    visitorsBridge.setCurrentFile(TestUtils.emptyInputFile(""));
    try {
      visitorsBridge.visitFile(null);
      assertThat(sonarComponents.analysisErrors).hasSize(1);
    } catch (Exception e) {
      e.printStackTrace();
      Fail.fail("Exception should be swallowed when property is not set");
    }

    sensorContextTester.settings().appendProperty(SonarComponents.FAIL_ON_EXCEPTION_KEY, "true");
    try {
      visitorsBridge.visitFile(null);
      Fail.fail("scanning of file should have raise an exception");
    } catch (Exception e) {
      assertThat(e).isSameAs(npe);
    }

  }

