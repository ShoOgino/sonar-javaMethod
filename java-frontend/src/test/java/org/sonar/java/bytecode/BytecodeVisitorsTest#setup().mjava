  @BeforeClass
  public static void setup() {
    JavaConfiguration conf = new JavaConfiguration(Charset.forName("UTF-8"));
    File baseDir = new File("src/test/files/bytecode/src");
    SensorContext sensorContext = mock(SensorContext.class);
    when(sensorContext.getResource(Matchers.any(InputPath.class))).thenAnswer(new Answer<org.sonar.api.resources.File>() {
      @Override
      public org.sonar.api.resources.File answer(InvocationOnMock invocation) throws Throwable {
        org.sonar.api.resources.File response = org.sonar.api.resources.File.create(((InputPath) invocation.getArguments()[0]).relativePath());
        response.setEffectiveKey("");
        return response;
      }
    });
    Collection<File> files = FileUtils.listFiles(baseDir, new String[] {"java"}, true);
    DefaultFileSystem fs = new DefaultFileSystem(baseDir);
    fs.setBaseDir(baseDir);
    for (File javaFile : files) {
      DefaultInputFile inputFile = new DefaultInputFile(javaFile.getPath());
      fs.add(inputFile);
    }
    DefaultJavaResourceLocator javaResourceLocator = new DefaultJavaResourceLocator(fs, null, new SuppressWarningsFilter());
    javaResourceLocator.setSensorContext(sensorContext);
    JavaSquid squid = new JavaSquid(conf, null, null, javaResourceLocator, null);
    File binDir = new File("src/test/files/bytecode/bin");
    squid.scan(files, Collections.<File>emptyList(), Collections.singleton(binDir));
    graph = squid.getGraph();
    resourceMapping = javaResourceLocator.getResourceMapping();
    tag = findResource("tags/Tag.java");
    tagFile = findResource("tags/Tag.java");
    file = findResource("tags/File.java");
    line = findResource("tags/Line.java");
    tagName = findResource("tags/TagName.java");
    tagException = findResource("tags/TagException.java");
    language = findResource("tags/Language.java");
    sourceFile = findResource("tags/SourceFile.java");
    todo = findResource("tags/impl/Todo.java");
    fixme = findResource("tags/impl/FixMe.java");
    pacTag = findResource("tags");
    pacImpl = findResource("tags/impl");
  }

