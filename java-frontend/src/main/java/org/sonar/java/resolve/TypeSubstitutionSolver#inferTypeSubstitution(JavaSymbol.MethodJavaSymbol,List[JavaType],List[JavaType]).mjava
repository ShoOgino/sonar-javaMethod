  private TypeSubstitution inferTypeSubstitution(JavaSymbol.MethodJavaSymbol method, List<JavaType> formals, List<JavaType> argTypes) {
    TypeSubstitution substitution = new TypeSubstitution();

    if (formals.size() > argTypes.size() || formals.isEmpty() || argTypes.isEmpty()) {
      // no need to try to infer types
      return substitution;
    }

    List<JavaType.TypeVariableJavaType> typeVariablesToInfer = new ArrayList<>(method.typeVariableTypes);

    if (!typeVariablesToInfer.isEmpty()) {
      for (int i = 0; i < formals.size(); i++) {
        JavaType formalType = formals.get(i);
        JavaType argType = argTypes.get(i);
        boolean isLastParam = i == formals.size() - 1;

        substitution = inferTypeSubstitution(method, substitution, isLastParam, formalType, argType);

        if (substitution.typeVariables().containsAll(method.typeVariableTypes)) {
          // we found all the substitution
          break;
        }
      }
    }
    return substitution;
  }

