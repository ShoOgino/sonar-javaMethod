  @Test
  public void pmd() {
    MavenBuild build = MavenBuild.create(TestUtils.projectPom("pmd-external-report"))
      .setProperty("sonar.java.pmd.reportPaths", "target" + File.separator + "pmd.xml")
      .setGoals("org.apache.maven.plugins:maven-pmd-plugin:3.10.0:pmd", "sonar:sonar");
    orchestrator.executeBuild(build);

    String projectKey = "com.sonarsource.it.projects:pmd-external-report";
    List<Issue> issues = getExternalIssues(projectKey);
    if (externalIssuesSupported()) {
      assertThat(issues).hasSize(1);
      Issue issue = issues.get(0);
      assertThat(issue.componentKey()).isEqualTo(projectKey + ":src/main/java/Main.java");
      assertThat(issue.ruleKey()).isEqualTo("external_pmd:UnusedLocalVariable");
      assertThat(issue.line()).isEqualTo(3);
      assertThat(issue.message()).isEqualTo("Avoid unused local variables such as 'unused'.");
      assertThat(issue.severity()).isEqualTo("MAJOR");
      assertThat(issue.debt()).isEqualTo("5min");
    } else {
      assertThat(issues).isEmpty();
    }
  }

