  @Test
  public void unresolved_package_should_not_appear_in_index() {
    ResourceIndex resourceIndex = new ResourceIndex(false);

    JavaSquid squid = mock(JavaSquid.class);
    SquidIndex index = mock(SquidIndex.class);
    SensorContext context = mock(SensorContext.class);
    Project project = mock(Project.class);
    ProjectFileSystem moduleFileSystem = mock(ProjectFileSystem.class);

    SourceCode squidFile = new SourceFile("file", "file");
    SourcePackage squidPackage = new SourcePackage(PackageVisitor.UNRESOLVED_PACKAGE);
    squidPackage.addChild(squidFile);
    Collection<SourceCode> squidFiles = Lists.newArrayList(squidFile);

    when(squid.getIndex()).thenReturn(index);
    when(index.search(any(QueryByType.class))).thenReturn(squidFiles);
    when(project.getFileSystem()).thenReturn(moduleFileSystem);
    when(moduleFileSystem.getBasedir()).thenReturn(new File(this.getClass().getResource("/").getFile()));

    resourceIndex.loadSquidResources(squid, context, project);
    assertThat(resourceIndex).hasSize(1);
    assertThat(resourceIndex.containsKey(new SourceFile("file"))).isTrue();

  }

