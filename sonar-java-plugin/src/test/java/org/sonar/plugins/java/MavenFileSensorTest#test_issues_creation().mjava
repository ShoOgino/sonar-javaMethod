  @Test
  public void test_issues_creation() throws Exception {
    DefaultFileSystem fs = new DefaultFileSystem(new File(""));
    final File file = new File("src/test/files/maven/pom.xml");
    fs.add(new DefaultInputFile(file.getPath()).setFile(file).setLanguage(Java.KEY));
    SonarComponents sonarComponents = createSonarComponentsMock(fs);
    MavenFileSensor mps = new MavenFileSensor(sonarComponents, fs);

    SensorContext context = mock(SensorContext.class);
    when(context.getResource(any(InputPath.class))).thenReturn(org.sonar.api.resources.File.create("src/test/files/maven/pom.xml"));

    mps.analyse(mock(Project.class), context);

    verify(sonarComponents, times(1)).reportIssue(Mockito.argThat(new ArgumentMatcher<AnalyzerMessage>() {
      @Override
      public boolean matches(Object argument) {
        return file.getAbsolutePath().equals(((AnalyzerMessage) argument).getFile().getAbsolutePath());
      }
    }));
  }

