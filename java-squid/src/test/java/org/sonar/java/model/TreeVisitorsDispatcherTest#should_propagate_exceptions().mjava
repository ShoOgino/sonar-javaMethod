  @Test
  public void should_propagate_exceptions() {
    EmptyStatementTree emptyStatement = new JavaTree.EmptyStatementTreeImpl(Mockito.mock(AstNode.class));
    IfStatementTree ifStatement = new JavaTree.IfStatementTreeImpl(Mockito.mock(AstNode.class),
      new JavaTree.IdentifierTreeImpl(Mockito.mock(AstNode.class), "i"),
      emptyStatement,
      null
    );

    FakeVisitor visitor = Mockito.mock(FakeVisitor.class);
    Mockito.doThrow(RuntimeException.class).when(visitor).visit(Mockito.any(StatementTree.class));

    TreeVisitorsDispatcher dispatcher = new TreeVisitorsDispatcher(ImmutableList.of(visitor));
    thrown.expect(RuntimeException.class);
    JavaTree.scan(ifStatement, dispatcher);
  }

