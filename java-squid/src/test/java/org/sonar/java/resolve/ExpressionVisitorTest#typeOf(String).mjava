  private Type typeOf(String input) {
    AstNode astNode = new ParserAdapter<LexerlessGrammar>(Charsets.UTF_8, b.build()).parse(input);

    AstWalker astWalker = new AstWalker();
    SemanticModel semanticModel = mock(SemanticModel.class);
    when(semanticModel.getEnv(any(AstNode.class))).thenReturn(env);
    ExpressionVisitor visitor = new ExpressionVisitor(semanticModel, symbols, new Resolve());
    visitor.init();
    astWalker.addVisitor(visitor);
    astWalker.walkAndVisit(astNode);

    return visitor.getType(astNode);
  }

