  @Test
  public void creation_of_custom_checks() throws Exception {

    FileLinesContextFactory fileLinesContextFactory = mock(FileLinesContextFactory.class);
    ResourcePerspectives resourcePerspectives = mock(ResourcePerspectives.class);
    CheckFactory checkFactory = mock(CheckFactory.class);

    Checks<JavaCheck> checks = mock(Checks.class);
    when(checkFactory.<JavaCheck>create(anyString())).thenReturn(checks);
    when(checks.addAnnotatedChecks(anyCollectionOf(Class.class))).thenReturn(checks);
    when(checks.all()).thenReturn(Lists.<JavaCheck>newArrayList(new CustomCheck()));
    SonarComponents sonarComponents = new SonarComponents(fileLinesContextFactory, resourcePerspectives, null, null,
        checkFactory, new CheckRegistrar[]{new MyCheckRegistrer()});

    assertThat(sonarComponents.checkClasses()).hasSize(1);
    verify(checkFactory, times(1)).create("myRepo");
    verify(checks, times(1)).addAnnotatedChecks(anyCollectionOf(Class.class));
    verify(checks, times(1)).all();


  }

