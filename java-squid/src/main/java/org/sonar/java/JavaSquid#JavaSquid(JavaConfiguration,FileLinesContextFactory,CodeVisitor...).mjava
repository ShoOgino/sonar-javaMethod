  public JavaSquid(JavaConfiguration conf, @Nullable FileLinesContextFactory fileLinesContextFactory, CodeVisitor... visitors) {
    astScanner = JavaAstScanner.create(conf);
    if (fileLinesContextFactory != null) {
      astScanner.accept(new FileLinesVisitor(fileLinesContextFactory, conf.getCharset()));
    }

    squidIndex = (SquidIndex) astScanner.getIndex(); // TODO unchecked cast

    bytecodeScanner = new BytecodeScanner(squidIndex);
    bytecodeScanner.accept(new DITVisitor());
    bytecodeScanner.accept(new RFCVisitor());
    bytecodeScanner.accept(new NOCVisitor());
    bytecodeScanner.accept(new LCOM4Visitor(conf.getFieldsToExcludeFromLcom4Calculation()));
    bytecodeScanner.accept(new DependenciesVisitor(graph));

    // External visitors (typically Check ones):
    for (CodeVisitor visitor : visitors) {
      astScanner.accept(visitor);
      bytecodeScanner.accept(visitor);
    }
  }

