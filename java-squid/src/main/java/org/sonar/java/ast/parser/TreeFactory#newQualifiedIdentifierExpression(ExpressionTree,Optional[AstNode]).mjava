  public ExpressionTree newQualifiedIdentifierExpression(ExpressionTree qualifiedIdentifier, Optional<AstNode> identifierSuffix) {
    if (!identifierSuffix.isPresent()) {
      // id
      return qualifiedIdentifier;
    } else {
      AstNode identifierSuffixNode = identifierSuffix.get();
      if (identifierSuffixNode.getFirstChild().is(JavaPunctuator.LBRK)) {
        if (identifierSuffixNode.hasDirectChildren(JavaKeyword.CLASS)) {
          // 15.8.2. Class Literals
          // id[].class
          return new MemberSelectExpressionTreeImpl(
            treeMaker.applyDim(qualifiedIdentifier, identifierSuffixNode.getChildren(JavaGrammar.DIM).size() + 1),
            treeMaker.identifier(identifierSuffixNode.getFirstChild(JavaKeyword.CLASS)),
            (AstNode) qualifiedIdentifier, identifierSuffixNode);
        } else {
          // id[expression]
          return new ArrayAccessExpressionTreeImpl(
            qualifiedIdentifier, treeMaker.expression(identifierSuffixNode.getFirstChild(JavaGrammar.EXPRESSION)),
            (AstNode) qualifiedIdentifier, identifierSuffixNode);
        }
      } else if (identifierSuffixNode.getFirstChild().is(JavaGrammar.ARGUMENTS)) {
        // id(arguments)
        return new MethodInvocationTreeImpl(
          qualifiedIdentifier, (ArgumentListTreeImpl) identifierSuffixNode.getFirstChild(),
          (AstNode) qualifiedIdentifier, identifierSuffixNode);
      } else if (identifierSuffixNode.getFirstChild().is(JavaPunctuator.DOT)) {
        if (identifierSuffixNode.hasDirectChildren(JavaKeyword.CLASS)) {
          // 15.8.2. Class Literals
          // id.class
          return new MemberSelectExpressionTreeImpl(
            qualifiedIdentifier, treeMaker.identifier(identifierSuffixNode.getFirstChild(JavaKeyword.CLASS)),
            (AstNode) qualifiedIdentifier, identifierSuffixNode);
        } else if (identifierSuffixNode.hasDirectChildren(JavaGrammar.EXPLICIT_GENERIC_INVOCATION)) {
          // id.<...>...
          return applyExplicitGenericInvocation(
            qualifiedIdentifier, identifierSuffixNode.getFirstChild(JavaPunctuator.DOT), identifierSuffixNode.getFirstChild(JavaGrammar.EXPLICIT_GENERIC_INVOCATION));
        } else if (identifierSuffixNode.hasDirectChildren(JavaKeyword.THIS)) {
          // id.this
          return new MemberSelectExpressionTreeImpl(
            qualifiedIdentifier, treeMaker.identifier(identifierSuffixNode.getFirstChild(JavaKeyword.THIS)),
            (AstNode) qualifiedIdentifier, identifierSuffixNode);
        } else if (identifierSuffixNode.hasDirectChildren(JavaKeyword.SUPER)) {
          // id.super(arguments)
          IdentifierTreeImpl superIdentifier = new IdentifierTreeImpl(InternalSyntaxToken.create(identifierSuffixNode.getFirstChild(JavaKeyword.SUPER)));

          MemberSelectExpressionTreeImpl memberSelect = new MemberSelectExpressionTreeImpl(
            qualifiedIdentifier, superIdentifier,
            (AstNode) qualifiedIdentifier, identifierSuffixNode.getFirstChild(JavaPunctuator.DOT), superIdentifier);

          return new MethodInvocationTreeImpl(
            memberSelect, (ArgumentListTreeImpl) identifierSuffixNode.getFirstChild(JavaGrammar.ARGUMENTS),
            memberSelect, identifierSuffixNode.getFirstChild(JavaGrammar.ARGUMENTS));
        } else if (identifierSuffixNode.hasDirectChildren(JavaKeyword.NEW)) {
          // id.new...
          AstNode innerCreatorNode = identifierSuffixNode.getFirstChild(JavaGrammar.INNER_CREATOR);

          AstNode classCreatorRestNode = innerCreatorNode.getFirstChild(JavaGrammar.CLASS_CREATOR_REST);

          ClassTree classBody = null;
          if (classCreatorRestNode.hasDirectChildren(JavaGrammar.CLASS_BODY)) {
            classBody = new ClassTreeImpl(
              classCreatorRestNode,
              Tree.Kind.CLASS,
              ModifiersTreeImpl.EMPTY,
              treeMaker.classBody(classCreatorRestNode.getFirstChild(JavaGrammar.CLASS_BODY)));
          }
          return new NewClassTreeImpl(
            qualifiedIdentifier,
            treeMaker.identifier(innerCreatorNode.getFirstChild(JavaTokenType.IDENTIFIER)),
            (ArgumentListTreeImpl) classCreatorRestNode.getFirstChild(JavaGrammar.ARGUMENTS),
            classBody,
            (AstNode) qualifiedIdentifier, identifierSuffixNode);
        } else {
          throw new IllegalArgumentException("Unexpected AstNodeType: " + identifierSuffixNode.getChild(1));
        }
      } else {
        throw new IllegalArgumentException("Unexpected AstNodeType: " + identifierSuffixNode.getFirstChild());
      }
    }
  }

