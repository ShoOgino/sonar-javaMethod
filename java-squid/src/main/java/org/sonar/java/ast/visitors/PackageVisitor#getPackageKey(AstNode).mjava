  private String getPackageKey(AstNode astNode) {
    if (astNode == null) {
      // TODO error during parse?
      return "";
    }
    String packageKey;
    if (astNode.getChild(0).is(getContext().getGrammar().packageDeclaration)) {
      AstNode packageNameNode = astNode.getChild(0).findFirstDirectChild(getContext().getGrammar().qualifiedIdentifier);
      packageKey = getAstNodeValue(packageNameNode).replace('.', '/');
    } else {
      // Guess package key from directory
      packageKey = InputFileUtils.getRelativeDirectory(getInputFile());
    }
    checkPhysicalDirectory(packageKey);
    return packageKey;
  }

